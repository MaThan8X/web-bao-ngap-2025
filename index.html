<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hệ Thống Cảnh Báo Ngập 2025</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Main CSS (Sẽ được JS load lại để tránh cache) -->
    <link id="main-stylesheet" rel="stylesheet" href="styles.css">
    
    <link rel="icon" href="data:,">
</head>
<body>

    <!-- 1. HEADER -->
    <div id="header">
        <h1>HỆ THỐNG CẢNH BÁO NGẬP LỤT TRỰC TUYẾN 2025</h1>
    </div>

    <!-- 2. MAIN CONTAINER -->
    <div id="main-container">
        
        <!-- SIDEBAR (Thanh vị trí) -->
        <div id="sidebar">
            <div style="padding: 15px; border-bottom: 1px solid #ddd; background: #fff;">
                <button id="add-station-btn">+ THÊM KHU VỰC MỚI</button>
            </div>
            
            <div id="station-list-container">
                <ul id="station-list">
                    <!-- Danh sách trạm sẽ được JS render vào đây -->
                    <li style="padding: 20px; text-align: center; color: #666;">Đang tải dữ liệu...</li>
                </ul>
            </div>
        </div>

        <!-- MAP (Bản đồ) -->
        <div id="map"></div>
    </div>

    <!-- 3. MODAL CẤU HÌNH (Khung cài đặt bị thiếu) -->
    <div id="config-modal" class="modal-overlay">
        <div class="modal-content">
            <h2>Cấu Hình Điểm Cảnh Báo</h2>
            
            <form id="config-form">
                <!-- Tên trạm -->
                <div class="form-group">
                    <label for="config-name">Tên Gợi Nhớ:</label>
                    <input type="text" id="config-name" required placeholder="Ví dụ: Ngã ba Trần Hưng Đạo..." autocomplete="off">
                </div>

                <!-- ID Thiết bị -->
                <div class="form-group">
                    <label for="config-id">ID Thiết Bị (Khớp với Chip):</label>
                    <input type="text" id="config-id" required placeholder="Ví dụ: T00001" autocomplete="off">
                    <small style="color: #dc3545; display: block; margin-top: 5px; font-style: italic;">
                        * Lưu ý: ID này không được sửa sau khi tạo, phải trùng với code nạp trong Chip.
                    </small>
                </div>

                <!-- Tọa độ -->
                <div class="form-group">
                    <label for="config-lat-lon">Tọa độ (Vĩ độ, Kinh độ):</label>
                    <input type="text" id="config-lat-lon" required placeholder="VD: 20.2647, 105.9754" autocomplete="off">
                    <small style="color: #666; display: block; margin-top: 5px;">
                        * Mẹo: Click chuột phải vào Google Maps để lấy số này.
                    </small>
                </div>
                
                <!-- Nút bấm -->
                <div class="modal-actions">
                    <button type="button" id="btn-cancel">Hủy Bỏ</button>
                    <button type="submit" id="btn-save">Lưu Cấu Hình</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Script Loader (Chống Cache) -->
    <script>
        // Tạo timestamp để ép trình duyệt tải file mới nhất
        const v = Date.now();
        
        // 1. Reload CSS
        document.getElementById('main-stylesheet').href = 'styles.css?v=' + v;
        
        // 2. Load JS
        const script = document.createElement('script');
        script.src = 'map-handler.js?v=' + v;
        document.body.appendChild(script);
    </script>

</body>
</html>
